# 测试设计: 知识图谱构建服务 (Epic 2.4)

**日期**: 2025-09-09  
**设计师**: Quinn (测试架构师)

## 测试策略概览

基于知识图谱服务架构分析，本服务为**无状态知识计算微服务**，专注于历史文本的知识图谱构建和智能分析：

- **总测试场景数**: 92个
- **单元测试**: 48个 (52%)  
- **集成测试**: 28个 (30%)
- **E2E测试**: 16个 (18%)
- **优先级分布**: P0: 28个, P1: 38个, P2: 20个, P3: 6个

## 关键测试原则

1. **知识准确性**: 实体识别、关系抽取和图谱构建的准确性验证
2. **算法多样性**: spaCy、BERT、jieba等多种NLP引擎的兼容性测试
3. **图谱质量**: 知识图谱的完整性、一致性和查询效率验证
4. **历史文本特化**: 古代人名、地名、关系的专业识别能力

## 按功能模块的测试场景

### 模块1: 实体抽取 (`/api/v1/knowledge-graph/entities/extract`)

#### AC1: 基础实体识别

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-001 | Unit | P0 | spaCy人名识别算法准确性 | 核心实体识别算法 |
| 2.4-UNIT-002 | Unit | P0 | spaCy地名识别算法准确性 | 核心实体识别算法 |
| 2.4-UNIT-003 | Unit | P0 | spaCy机构名识别算法准确性 | 核心实体识别算法 |
| 2.4-UNIT-004 | Unit | P1 | BERT实体识别算法准确性 | 高级NLP模型算法 |
| 2.4-UNIT-005 | Unit | P1 | jieba实体识别算法准确性 | 中文特化识别算法 |
| 2.4-UNIT-006 | Unit | P0 | 实体置信度评估算法 | 质量控制核心逻辑 |
| 2.4-INT-001 | Integration | P0 | 多引擎实体识别结果对比 | 引擎兼容性集成验证 |
| 2.4-E2E-001 | E2E | P0 | 完整实体抽取工作流程 | 端到端实体识别验证 |

#### AC2: 古文实体识别特化

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-007 | Unit | P0 | 古代人名识别算法优化 | 历史文献特化需求 |
| 2.4-UNIT-008 | Unit | P0 | 古代地名识别算法优化 | 历史地理实体识别 |
| 2.4-UNIT-009 | Unit | P0 | 朝代官职识别算法 | 历史政治实体识别 |
| 2.4-UNIT-010 | Unit | P1 | 古代书名作品识别 | 文献作品实体识别 |
| 2.4-UNIT-011 | Unit | P1 | 古代度量衡识别 | 历史计量实体识别 |
| 2.4-INT-002 | Integration | P0 | 古文实体识别准确性验证 | 历史文献场景集成测试 |

### 模块2: 关系抽取 (`/api/v1/knowledge-graph/relations/extract`)

#### AC3: 基础关系识别

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-012 | Unit | P0 | 人物关系抽取算法 | 人际关系识别核心算法 |
| 2.4-UNIT-013 | Unit | P0 | 地理关系抽取算法 | 地理位置关系算法 |
| 2.4-UNIT-014 | Unit | P0 | 时间关系抽取算法 | 时序关系识别算法 |
| 2.4-UNIT-015 | Unit | P1 | 从属关系抽取算法 | 隶属关系识别算法 |
| 2.4-UNIT-016 | Unit | P1 | 因果关系抽取算法 | 逻辑关系识别算法 |
| 2.4-UNIT-017 | Unit | P0 | 关系置信度评估算法 | 关系质量评估逻辑 |

#### AC4: 基于规则的关系抽取

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-018 | Unit | P1 | 语法规则关系识别 | 规则引擎核心逻辑 |
| 2.4-UNIT-019 | Unit | P1 | 模式匹配关系抽取 | 模式识别算法逻辑 |
| 2.4-UNIT-020 | Unit | P2 | 依存句法关系分析 | 高级语法分析算法 |
| 2.4-INT-003 | Integration | P1 | 规则引擎与NLP模型结合 | 混合方法集成验证 |

#### AC5: 历史文本关系特化

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-021 | Unit | P0 | 古代君臣关系识别 | 历史政治关系特化 |
| 2.4-UNIT-022 | Unit | P0 | 古代家族关系识别 | 历史血缘关系识别 |
| 2.4-UNIT-023 | Unit | P1 | 古代师承关系识别 | 学术传承关系识别 |
| 2.4-INT-004 | Integration | P0 | 历史关系抽取准确性验证 | 历史文献关系场景测试 |

### 模块3: 知识图谱构建 (`/api/v1/knowledge-graph/graph/construct`)

#### AC6: 图谱构建算法

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-024 | Unit | P0 | 图节点创建算法 | 图构建核心逻辑 |
| 2.4-UNIT-025 | Unit | P0 | 图边创建算法 | 图构建核心逻辑 |
| 2.4-UNIT-026 | Unit | P0 | 实体去重算法 | 数据清理核心算法 |
| 2.4-UNIT-027 | Unit | P0 | 关系合并算法 | 关系整合核心逻辑 |
| 2.4-UNIT-028 | Unit | P1 | 图谱一致性检查算法 | 数据质量保证算法 |
| 2.4-INT-005 | Integration | P0 | 完整图谱构建集成验证 | 图谱构建端到端测试 |

#### AC7: 图谱优化算法

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-029 | Unit | P1 | 中心性计算算法 | 图分析核心算法 |
| 2.4-UNIT-030 | Unit | P1 | 社区发现算法 | 图聚类分析算法 |
| 2.4-UNIT-031 | Unit | P2 | 图谱密度分析算法 | 图结构分析算法 |
| 2.4-UNIT-032 | Unit | P2 | 路径分析算法 | 图路径计算算法 |
| 2.4-INT-006 | Integration | P1 | 图谱优化效果验证 | 优化算法集成测试 |

### 模块4: 图谱查询和分析

#### AC8: 基础查询功能

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-033 | Unit | P0 | 实体查询算法 | 基础查询核心功能 |
| 2.4-UNIT-034 | Unit | P0 | 关系查询算法 | 关系检索核心功能 |
| 2.4-UNIT-035 | Unit | P1 | 路径查询算法 | 图遍历查询算法 |
| 2.4-UNIT-036 | Unit | P1 | 子图查询算法 | 子图匹配算法逻辑 |
| 2.4-UNIT-037 | Unit | P2 | 相似性查询算法 | 语义相似查询算法 |
| 2.4-INT-007 | Integration | P0 | 查询性能优化验证 | 查询效率集成测试 |

#### AC9: 高级查询分析

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-038 | Unit | P1 | SPARQL查询解析算法 | 标准查询语言支持 |
| 2.4-UNIT-039 | Unit | P2 | Cypher查询解析算法 | 图数据库查询支持 |
| 2.4-UNIT-040 | Unit | P1 | 自然语言查询转换 | 智能查询转换算法 |
| 2.4-INT-008 | Integration | P1 | 多语言查询支持验证 | 查询语言兼容性测试 |

### 模块5: 概念挖掘和主题发现

#### AC10: 概念挖掘算法

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-041 | Unit | P1 | LDA主题模型算法 | 主题发现核心算法 |
| 2.4-UNIT-042 | Unit | P1 | Word2Vec概念聚类算法 | 语义聚类算法逻辑 |
| 2.4-UNIT-043 | Unit | P2 | BERT概念表示算法 | 深度语义表示算法 |
| 2.4-UNIT-044 | Unit | P1 | 概念层次构建算法 | 概念分类体系构建 |
| 2.4-INT-009 | Integration | P1 | 概念挖掘准确性验证 | 概念发现集成测试 |

### 模块6: 批量处理和异步任务

#### AC11: 批量图谱构建

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-INT-010 | Integration | P0 | 批量文档实体抽取 | 批量处理核心功能 |
| 2.4-INT-011 | Integration | P0 | 批量关系抽取管理 | 批量任务调度验证 |
| 2.4-INT-012 | Integration | P0 | 大规模图谱构建 | 规模化处理能力验证 |
| 2.4-INT-013 | Integration | P1 | 批量处理进度跟踪 | 任务监控集成验证 |
| 2.4-E2E-002 | E2E | P0 | 完整批量图谱构建流程 | 批量处理端到端验证 |

#### AC12: 异步任务管理

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-INT-014 | Integration | P0 | 异步图谱构建任务管理 | 异步机制核心功能 |
| 2.4-INT-015 | Integration | P0 | 任务状态跟踪更新 | 任务状态管理验证 |
| 2.4-INT-016 | Integration | P1 | 任务失败恢复机制 | 容错机制集成验证 |
| 2.4-E2E-003 | E2E | P0 | 异步任务完整生命周期 | 异步流程端到端验证 |

### 模块7: 图谱质量评估

#### AC13: 质量指标计算

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-UNIT-045 | Unit | P0 | 实体准确性评估算法 | 质量评估核心指标 |
| 2.4-UNIT-046 | Unit | P0 | 关系准确性评估算法 | 质量评估核心指标 |
| 2.4-UNIT-047 | Unit | P1 | 图谱完整性评估算法 | 完整性度量算法 |
| 2.4-UNIT-048 | Unit | P1 | 图谱一致性检查算法 | 一致性验证算法 |
| 2.4-INT-017 | Integration | P0 | 综合质量评分验证 | 质量评估集成测试 |

### 模块8: 存储和持久化

#### AC14: 数据持久化

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-INT-018 | Integration | P0 | 实体数据存储验证 | 数据持久化完整性 |
| 2.4-INT-019 | Integration | P0 | 关系数据存储验证 | 关系数据完整性 |
| 2.4-INT-020 | Integration | P0 | 图谱结构存储验证 | 图结构持久化 |
| 2.4-INT-021 | Integration | P1 | 图谱版本管理验证 | 版本控制集成测试 |

### 模块9: 系统健康和监控

#### AC15: 服务健康检查

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-INT-022 | Integration | P0 | NLP引擎状态检查 | 服务可用性验证 |
| 2.4-INT-023 | Integration | P0 | Storage服务连接验证 | 依赖服务健康检查 |
| 2.4-INT-024 | Integration | P1 | 图数据库连接验证 | 图存储健康检查 |
| 2.4-E2E-004 | E2E | P0 | Kubernetes探针集成 | 容器编排健康检查 |

### 模块10: 错误处理和异常管理

#### AC16: 异常情况处理

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-INT-025 | Integration | P0 | 无效文本输入处理 | 输入验证边界测试 |
| 2.4-INT-026 | Integration | P0 | 模型加载失败恢复 | 模型异常恢复机制 |
| 2.4-INT-027 | Integration | P1 | 大文本处理超时处理 | 超时容错机制验证 |
| 2.4-INT-028 | Integration | P1 | 图谱构建内存溢出处理 | 资源限制异常处理 |
| 2.4-E2E-005 | E2E | P0 | 服务降级和熔断验证 | 系统容错端到端测试 |

## 特殊测试场景

### 历史文献知识图谱特化测试

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-E2E-006 | E2E | P0 | 完整古籍知识图谱构建 | 历史文献端到端验证 |
| 2.4-E2E-007 | E2E | P0 | 历史人物关系网络构建 | 历史人物关系分析 |
| 2.4-E2E-008 | E2E | P1 | 历史事件时序图谱构建 | 历史事件脉络分析 |

### 性能和扩展性测试

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-E2E-009 | E2E | P0 | 大规模文本知识抽取性能 | 性能边界验证 |
| 2.4-E2E-010 | E2E | P1 | 高并发图谱查询能力 | 并发查询性能验证 |
| 2.4-E2E-011 | E2E | P1 | 长时间运行稳定性 | 服务稳定性验证 |

### 多语言和格式支持测试

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-E2E-012 | E2E | P2 | 中英文混合文本图谱构建 | 多语言支持验证 |
| 2.4-E2E-013 | E2E | P2 | 多种图谱格式导出 | 格式兼容性验证 |

### 容器化和部署测试

| 测试ID | 级别 | 优先级 | 测试场景 | 测试理由 |
|--------|------|--------|----------|----------|
| 2.4-E2E-014 | E2E | P1 | Docker容器启动和模型加载 | 容器化部署验证 |
| 2.4-E2E-015 | E2E | P2 | 多实例图谱服务集群 | 分布式部署验证 |
| 2.4-E2E-016 | E2E | P2 | GPU加速图谱构建能力 | 硬件加速验证 |

## 风险覆盖分析

### 高风险场景 (P0测试覆盖)
- **知识准确性风险**: 实体识别、关系抽取和图谱构建准确性验证
- **数据完整性风险**: 图谱数据存储和异步任务完整性保证
- **服务可用性风险**: 健康检查和异常恢复机制验证
- **历史文献专业风险**: 古文知识处理准确性验证

### 中等风险场景 (P1测试覆盖)
- **性能降级风险**: 大规模文本处理和图谱查询性能测试
- **算法一致性风险**: 多NLP引擎结果一致性验证
- **扩展性风险**: 批量处理和并发查询能力测试

## 建议的测试执行顺序

### 第一阶段 (P0 - 核心知识算法验证)
1. **单元测试** (2.4-UNIT-001 到 2.4-UNIT-048): 知识抽取和图谱构建算法
2. **关键集成测试**: 数据存储、异步处理、健康检查
3. **核心E2E测试**: 基础图谱构建和古文献处理

### 第二阶段 (P1 - 高级功能验证)
1. **高级算法测试**: 图谱优化、概念挖掘、智能查询
2. **性能集成测试**: 批量处理、并发查询
3. **完整E2E测试**: 异步流程、质量评估

### 第三阶段 (P2/P3 - 补充功能)
1. **优化功能测试**: 高级查询、多语言支持
2. **边缘场景测试**: 容器化部署、GPU加速

## 测试数据和环境要求

### 测试数据
- **现代文本**: 新闻、学术文章等标准中文文本
- **古文样本**: 史书、诗词、古籍等历史文献
- **知识基准**: 标准知识图谱数据集用于准确性对比
- **多语言样本**: 中英混合文本和国际化内容

### 环境要求
- **单元测试**: 本地环境，轻量级NLP模型
- **集成测试**: Docker容器，完整NLP模型和图数据库
- **E2E测试**: Kubernetes集群，生产级配置和GPU支持

## 成功标准

- **P0测试**: 100%通过率，知识抽取准确率≥85%
- **P1测试**: 95%通过率，图谱构建质量≥80%
- **P2测试**: 85%通过率，功能完整性验证
- **覆盖率**: 单元测试>85%，集成测试>75%

## 质量门控制点

- **代码合并**: P0单元测试100%通过，知识抽取准确性达标
- **部署测试环境**: P0+P1集成测试95%通过
- **生产部署**: P0 E2E测试100%通过，古文献知识抽取质量验证
- **发布就绪**: 完整测试套件执行，准确性和性能双达标

---

**备注**: 知识图谱服务测试特别关注知识抽取的准确性和图谱构建的质量。所有NLP算法应使用标准数据集进行基准测试，特别是古文献处理能力需要与领域专家评估结果进行对比验证。图谱质量评估需要建立专业的历史文献知识验证体系。