============================= test session starts ==============================
platform darwin -- Python 3.9.6, pytest-7.4.3, pluggy-1.6.0 -- /Library/Developer/CommandLineTools/usr/bin/python3
cachedir: .pytest_cache
rootdir: /Users/yjlh/Documents/code/Historical Text Project/services/file-processor
plugins: cov-4.1.0, asyncio-0.21.1, mock-3.12.0, anyio-3.7.1
asyncio: mode=strict
collecting ... collected 10 items

tests/unit/test_file_validation.py::TestFileValidation::test_valid_file_extensions PASSED [ 10%]
tests/unit/test_file_validation.py::TestFileValidation::test_invalid_file_extensions PASSED [ 20%]
tests/unit/test_file_validation.py::TestFileValidation::test_file_size_validation PASSED [ 30%]
tests/unit/test_file_validation.py::TestFileValidation::test_file_content_validation FAILED [ 40%]
tests/unit/test_file_validation.py::TestFileValidation::test_comprehensive_file_validation PASSED [ 50%]
tests/unit/test_pdf_processing.py::TestPDFProcessing::test_extract_text_from_simple_pdf FAILED [ 60%]
tests/unit/test_pdf_processing.py::TestPDFProcessing::test_extract_text_from_complex_layout_pdf PASSED [ 70%]
tests/unit/test_pdf_processing.py::TestPDFProcessing::test_handle_corrupted_pdf FAILED [ 80%]
tests/unit/test_pdf_processing.py::TestPDFProcessing::test_pdf_metadata_extraction PASSED [ 90%]
tests/unit/test_pdf_processing.py::TestPDFProcessing::test_large_pdf_processing PASSED [100%]

=================================== FAILURES ===================================
_______________ TestFileValidation.test_file_content_validation ________________
tests/unit/test_file_validation.py:178: in test_file_content_validation
    assert result["valid"] is False, f"未知文件应该被拒绝，但得到: {result}"
E   AssertionError: 未知文件应该被拒绝，但得到: {'valid': True, 'type': 'text', 'confidence': 0.7}
E   assert True is False
_____________ TestPDFProcessing.test_extract_text_from_simple_pdf ______________
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:1227: in _dot_lookup
    return getattr(thing, comp)
E   AttributeError: module 'src' has no attribute 'services'

During handling of the above exception, another exception occurred:
tests/unit/test_pdf_processing.py:34: in test_extract_text_from_simple_pdf
    with patch('src.services.pdf_processor.PyPDF2') as mock_pypdf:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:1389: in __enter__
    self.target = self.getter()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:1564: in <lambda>
    getter = lambda: _importer(target)
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:1240: in _importer
    thing = _dot_lookup(thing, comp, import_path)
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:1229: in _dot_lookup
    __import__(import_path)
E   ModuleNotFoundError: No module named 'src.services'
_________________ TestPDFProcessing.test_handle_corrupted_pdf __________________
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:1227: in _dot_lookup
    return getattr(thing, comp)
E   AttributeError: module 'src' has no attribute 'services'

During handling of the above exception, another exception occurred:
tests/unit/test_pdf_processing.py:98: in test_handle_corrupted_pdf
    with patch('src.services.pdf_processor.PyPDF2') as mock_pypdf:
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:1389: in __enter__
    self.target = self.getter()
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:1564: in <lambda>
    getter = lambda: _importer(target)
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:1240: in _importer
    thing = _dot_lookup(thing, comp, import_path)
/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/unittest/mock.py:1229: in _dot_lookup
    __import__(import_path)
E   ModuleNotFoundError: No module named 'src.services'
=============================== warnings summary ===============================
../../../../../Library/Python/3.9/lib/python/site-packages/pydantic/_internal/_config.py:268
../../../../../Library/Python/3.9/lib/python/site-packages/pydantic/_internal/_config.py:268
../../../../../Library/Python/3.9/lib/python/site-packages/pydantic/_internal/_config.py:268
../../../../../Library/Python/3.9/lib/python/site-packages/pydantic/_internal/_config.py:268
../../../../../Library/Python/3.9/lib/python/site-packages/pydantic/_internal/_config.py:268
  /Users/yjlh/Library/Python/3.9/lib/python/site-packages/pydantic/_internal/_config.py:268: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

src/config/settings.py:164
  /Users/yjlh/Documents/code/Historical Text Project/services/file-processor/src/config/settings.py:164: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    @validator('service')

src/config/settings.py:172
  /Users/yjlh/Documents/code/Historical Text Project/services/file-processor/src/config/settings.py:172: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    @validator('content')

../../../../../Library/Python/3.9/lib/python/site-packages/PyPDF2/__init__.py:21
  /Users/yjlh/Library/Python/3.9/lib/python/site-packages/PyPDF2/__init__.py:21: DeprecationWarning: PyPDF2 is deprecated. Please move to the pypdf library instead.
    warnings.warn(

tests/unit/test_file_validation.py::TestFileValidation::test_comprehensive_file_validation
  /Users/yjlh/Library/Python/3.9/lib/python/site-packages/_pytest/python.py:198: PytestReturnNotNoneWarning: Expected None, but tests/unit/test_file_validation.py::TestFileValidation::test_comprehensive_file_validation returned {'filename': 'test_document.pdf', 'overall_valid': True, 'extension_check': True, 'size_check': True, 'content_check': True, 'detected_type': 'pdf', 'confidence': 0.95}, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/unit/test_file_validation.py::TestFileValidation::test_file_content_validation
FAILED tests/unit/test_pdf_processing.py::TestPDFProcessing::test_extract_text_from_simple_pdf
FAILED tests/unit/test_pdf_processing.py::TestPDFProcessing::test_handle_corrupted_pdf
=================== 3 failed, 7 passed, 9 warnings in 0.19s ====================
