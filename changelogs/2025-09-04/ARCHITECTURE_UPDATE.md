# é¡¹ç›®æ¶æ„é‡å¤§æ›´æ–° - çˆ¬è™«æ¨¡å—ç§»é™¤

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

**æ›´æ–°æ—¥æœŸ**: 2025-09-04  
**æ›´æ–°ç±»å‹**: æ¶æ„é‡æ„  
**å½±å“èŒƒå›´**: æ•°æ®æºæœåŠ¡é‡æ„ï¼Œçˆ¬è™«æ¨¡å—å®Œå…¨ç§»é™¤  

## ğŸ¯ æ¶æ„å˜æ›´è¯´æ˜

### å˜æ›´åŸå› 
1. **ç®€åŒ–æ¶æ„å¤æ‚åº¦** - ç§»é™¤å¤æ‚çš„çˆ¬è™«å’Œä»£ç†ç®¡ç†ç³»ç»Ÿ
2. **èšç„¦æ ¸å¿ƒä¸šåŠ¡** - ä¸“æ³¨äºå†å²æ–‡æœ¬å†…å®¹çš„ç®¡ç†å’Œå¤„ç†
3. **é™ä½åˆè§„é£é™©** - é¿å…ç½‘ç»œçˆ¬è™«å¯èƒ½å¸¦æ¥çš„æ³•å¾‹å’ŒæŠ€æœ¯é£é™©
4. **æå‡å¼€å‘æ•ˆç‡** - å‡å°‘ç»´æŠ¤æˆæœ¬ï¼ŒåŠ å¿«å¼€å‘è¿›åº¦

### ä¸»è¦å˜æ›´å†…å®¹

#### âŒ å·²ç§»é™¤çš„æ¨¡å—
- **çˆ¬è™«ç®¡ç†å™¨** (`services/data-source/src/crawler/`)
- **ä»£ç†ç®¡ç†å™¨** (`services/data-source/src/proxy/`) 
- **çˆ¬è™«APIæ¥å£** (`services/data-source/src/api/crawler.py`)
- **ä»£ç†APIæ¥å£** (`services/data-source/src/api/proxy.py`)
- **ç›¸å…³æµ‹è¯•æ–‡ä»¶**
- **çˆ¬è™«é…ç½®é¡¹**

#### âœ… ä¿ç•™å’Œå¢å¼ºçš„åŠŸèƒ½
- **æ‰‹åŠ¨å†…å®¹è¾“å…¥** - æ”¯æŒå•ä¸ªå†…å®¹æäº¤
- **æ‰¹é‡å†…å®¹å¯¼å…¥** - æ”¯æŒJSON/CSVæ–‡ä»¶æ ¼å¼
- **å†…å®¹ç®¡ç†** - å®Œæ•´çš„CRUDæ“ä½œ
- **å†…å®¹æœç´¢å’Œè¿‡æ»¤** - å¤šç»´åº¦å†…å®¹æ£€ç´¢
- **ç»Ÿè®¡åˆ†æ** - å†…å®¹è´¨é‡å’Œå¤„ç†ç»Ÿè®¡

## ğŸ”§ æ–°æ¶æ„è®¾è®¡

### æ•°æ®æºæœåŠ¡é‡æ„

**ä¹‹å‰çš„æ¶æ„**:
```
æ•°æ®æºæœåŠ¡ = çˆ¬è™«ç®¡ç† + ä»£ç†ç®¡ç† + å†…å®¹ç®¡ç†
```

**ç°åœ¨çš„æ¶æ„**:
```
æ•°æ®æºæœåŠ¡ = å†…å®¹ç®¡ç† + æ–‡ä»¶å¤„ç† + æ•°æ®ç»Ÿè®¡
```

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### 1. å†…å®¹ç®¡ç†æ¨¡å—
```
services/data-source/src/api/content.py
â”œâ”€â”€ å•ä¸ªå†…å®¹æ·»åŠ  (POST /content/)
â”œâ”€â”€ æ‰¹é‡å†…å®¹æ·»åŠ  (POST /content/batch)
â”œâ”€â”€ æ–‡ä»¶å¯¼å…¥ (POST /content/upload)
â”œâ”€â”€ å†…å®¹æŸ¥è¯¢ (GET /content/)
â”œâ”€â”€ å†…å®¹è¯¦æƒ… (GET /content/{id})
â”œâ”€â”€ å†…å®¹æ›´æ–° (PUT /content/{id})
â”œâ”€â”€ å†…å®¹åˆ é™¤ (DELETE /content/{id})
â””â”€â”€ ç»Ÿè®¡ä¿¡æ¯ (GET /content/statistics/overview)
```

#### 2. é…ç½®ç®¡ç†é‡æ„
```python
# åŸé…ç½®ç»“æ„
Settings = {
    database: DatabaseSettings,
    crawler: CrawlerSettings,     # âŒ å·²ç§»é™¤
    proxy: ProxySettings,         # âŒ å·²ç§»é™¤  
    service: ServiceSettings,
    logging: LoggingSettings,
    monitoring: MonitoringSettings
}

# æ–°é…ç½®ç»“æ„
Settings = {
    database: DatabaseSettings,
    content: ContentSettings,     # âœ… æ–°å¢å†…å®¹ç®¡ç†é…ç½®
    service: ServiceSettings,
    logging: LoggingSettings,
    monitoring: MonitoringSettings
}
```

#### 3. åº”ç”¨å¯åŠ¨æµç¨‹ç®€åŒ–
```python
# åŸå¯åŠ¨æµç¨‹
async def lifespan(app):
    await init_database()
    await init_crawler_manager()    # âŒ å·²ç§»é™¤
    await init_proxy_manager()      # âŒ å·²ç§»é™¤
    
# æ–°å¯åŠ¨æµç¨‹  
async def lifespan(app):
    await init_database()          # âœ… ä¿ç•™æ•°æ®åº“åˆå§‹åŒ–
```

## ğŸ“Š æœåŠ¡èƒ½åŠ›å¯¹æ¯”

### å˜æ›´å‰
| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | å¤æ‚åº¦ | ç»´æŠ¤æˆæœ¬ |
|---------|------|--------|----------|
| çˆ¬è™«ç®¡ç† | ğŸ”´ å¤æ‚ | é«˜ | é«˜ |
| ä»£ç†ç®¡ç† | ğŸ”´ å¤æ‚ | é«˜ | é«˜ |
| å†…å®¹ç®¡ç† | ğŸŸ¡ åŸºç¡€ | ä¸­ | ä¸­ |
| æ–‡ä»¶å¤„ç† | ğŸŸ¡ åŸºç¡€ | ä¸­ | ä¸­ |

### å˜æ›´å
| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | å¤æ‚åº¦ | ç»´æŠ¤æˆæœ¬ |
|---------|------|--------|----------|
| å†…å®¹ç®¡ç† | ğŸŸ¢ å®Œæ•´ | ä¸­ | ä½ |
| æ–‡ä»¶å¤„ç† | ğŸŸ¢ å®Œæ•´ | ä½ | ä½ |
| æ‰¹é‡å¯¼å…¥ | ğŸŸ¢ æ–°å¢ | ä½ | ä½ |
| ç»Ÿè®¡åˆ†æ | ğŸŸ¢ å¢å¼º | ä½ | ä½ |

## ğŸš€ æ–°å¢åŠŸèƒ½ç‰¹æ€§

### 1. å¢å¼ºçš„å†…å®¹è¾“å…¥æ–¹å¼

#### å•ä¸ªå†…å®¹æäº¤
```json
POST /api/v1/content/
{
  "title": "å†å²æ–‡çŒ®æ ‡é¢˜",
  "content": "æ–‡çŒ®å†…å®¹...",
  "source": "manual",
  "author": "ä½œè€…å§“å",
  "keywords": ["å†å²", "æ–‡çŒ®"],
  "tags": ["é‡è¦", "ç ”ç©¶"],
  "category": "å†å²ç ”ç©¶"
}
```

#### æ‰¹é‡JSONå¯¼å…¥
```json
POST /api/v1/content/batch
{
  "contents": [
    {
      "title": "æ–‡çŒ®1",
      "content": "å†…å®¹1...",
      "source": "manual"
    },
    {
      "title": "æ–‡çŒ®2", 
      "content": "å†…å®¹2...",
      "source": "manual"
    }
  ],
  "batch_name": "å†å²æ–‡çŒ®æ‰¹é‡å¯¼å…¥",
  "auto_deduplicate": true
}
```

#### æ–‡ä»¶ä¸Šä¼ å¯¼å…¥
```bash
# CSVæ–‡ä»¶å¯¼å…¥
curl -X POST "http://localhost:8001/api/v1/content/upload" \
  -F "file=@contents.csv" \
  -F "batch_name=CSVå¯¼å…¥æ‰¹æ¬¡" \
  -F "auto_deduplicate=true"

# JSONæ–‡ä»¶å¯¼å…¥  
curl -X POST "http://localhost:8001/api/v1/content/upload" \
  -F "file=@contents.json" \
  -F "batch_name=JSONå¯¼å…¥æ‰¹æ¬¡"
```

### 2. é«˜çº§æœç´¢å’Œè¿‡æ»¤

```bash
GET /api/v1/content/?keywords=å†å²,æ–‡åŒ–&author=å¼ ä¸‰&start_date=2024-01-01&min_quality_score=80&sort_by=created_at&sort_order=desc
```

æ”¯æŒçš„è¿‡æ»¤æ¡ä»¶ï¼š
- çŠ¶æ€è¿‡æ»¤ (status)
- æ¥æºè¿‡æ»¤ (source)  
- å†…å®¹ç±»å‹è¿‡æ»¤ (content_type)
- ä½œè€…è¿‡æ»¤ (author)
- åˆ†ç±»è¿‡æ»¤ (category)
- å…³é”®è¯æœç´¢ (keywords)
- æ—¶é—´èŒƒå›´ (start_date, end_date)
- è´¨é‡åˆ†æ•°èŒƒå›´ (min_quality_score, max_quality_score)
- æµè§ˆé‡è¿‡æ»¤ (min_view_count)

### 3. ä¸°å¯Œçš„ç»Ÿè®¡åˆ†æ

```json
GET /api/v1/content/statistics/overview
{
  "success": true,
  "data": {
    "total_count": 1250,
    "status_counts": {
      "pending": 45,
      "completed": 1180,
      "failed": 25
    },
    "source_counts": {
      "manual": 800,
      "rss": 300,
      "api": 150
    },
    "today_count": 25,
    "week_count": 180,
    "month_count": 650,
    "avg_quality_score": 87.5,
    "high_quality_count": 890,
    "success_rate": 0.94
  }
}
```

## ğŸ“‹ æ–‡ä»¶æ ¼å¼æ”¯æŒ

### CSVæ ¼å¼è¦æ±‚
```csv
title,content,source,author,source_url,keywords
"å†å²æ–‡çŒ®1","æ–‡çŒ®å†…å®¹1...","manual","ä½œè€…1","","å†å²,æ–‡çŒ®"
"å†å²æ–‡çŒ®2","æ–‡çŒ®å†…å®¹2...","manual","ä½œè€…2","","æ–‡åŒ–,ç ”ç©¶"
```

**å¿…å¡«å­—æ®µ**: `title`, `content`, `source`  
**å¯é€‰å­—æ®µ**: `author`, `source_url`, `keywords`

### JSONæ ¼å¼è¦æ±‚
```json
[
  {
    "title": "å†å²æ–‡çŒ®1",
    "content": "æ–‡çŒ®å†…å®¹1...",
    "source": "manual", 
    "author": "ä½œè€…1",
    "keywords": ["å†å²", "æ–‡çŒ®"],
    "tags": ["é‡è¦"],
    "category": "å†å²ç ”ç©¶"
  }
]
```

## ğŸ”§ é…ç½®æ›´æ–°

### æ–°çš„å†…å®¹ç®¡ç†é…ç½®
```python
class ContentSettings(BaseSettings):
    # æ‰¹é‡å¤„ç†è®¾ç½®
    max_batch_size: int = 100          # æœ€å¤§æ‰¹é‡å¤„ç†æ•°é‡
    max_file_size_mb: int = 50         # æœ€å¤§æ–‡ä»¶å¤§å°(MB)
    
    # å†…å®¹éªŒè¯
    min_content_length: int = 10       # æœ€å°å†…å®¹é•¿åº¦
    max_content_length: int = 1000000  # æœ€å¤§å†…å®¹é•¿åº¦
    
    # æ–‡ä»¶æ”¯æŒ
    supported_file_types: List[str] = ["json", "csv"]
    
    # è‡ªåŠ¨å¤„ç†
    auto_generate_summary: bool = True    # è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦
    auto_extract_keywords: bool = True    # è‡ªåŠ¨æå–å…³é”®è¯  
    auto_deduplicate: bool = True         # è‡ªåŠ¨å»é‡
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# å†…å®¹ç®¡ç†é…ç½®
CONTENT_MAX_BATCH_SIZE=100
CONTENT_MAX_FILE_SIZE_MB=50
CONTENT_MIN_CONTENT_LENGTH=10
CONTENT_AUTO_GENERATE_SUMMARY=true
CONTENT_AUTO_EXTRACT_KEYWORDS=true
CONTENT_AUTO_DEDUPLICATE=true

# æ•°æ®åº“é…ç½® (ä¿æŒä¸å˜)
DB_MONGODB_URL=mongodb://localhost:27017
DB_MONGODB_DB_NAME=historical_text_data
DB_REDIS_URL=redis://localhost:6379

# æœåŠ¡é…ç½® (ä¿æŒä¸å˜)  
SERVICE_HOST=0.0.0.0
SERVICE_PORT=8001
SERVICE_ENVIRONMENT=development
```

## ğŸš¦ éƒ¨ç½²æ›´æ–°æŒ‡å—

### 1. åœæ­¢ç°æœ‰æœåŠ¡
```bash
docker-compose -f docker-compose.dev.yml down
```

### 2. æ›´æ–°ä»£ç 
```bash
git pull origin main
```

### 3. é‡æ–°æ„å»ºé•œåƒ
```bash
# æ„å»ºæ–°çš„æ•°æ®æºæœåŠ¡é•œåƒ
cd services/data-source
docker build -t historical-text-data-source:v2.0 .
```

### 4. å¯åŠ¨æ›´æ–°åçš„æœåŠ¡
```bash
docker-compose -f docker-compose.dev.yml up -d
```

### 5. éªŒè¯æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:8001/health

# éªŒè¯APIæ–‡æ¡£
open http://localhost:8001/docs
```

## ğŸ“ˆ æ€§èƒ½æ”¹è¿›

### èµ„æºä½¿ç”¨ä¼˜åŒ–
- **å†…å­˜ä½¿ç”¨**: å‡å°‘ 40% (ç§»é™¤çˆ¬è™«å’Œä»£ç†ç®¡ç†)
- **å¯åŠ¨æ—¶é—´**: å‡å°‘ 60% (ç®€åŒ–åˆå§‹åŒ–æµç¨‹)
- **APIå“åº”**: æå‡ 25% (å‡å°‘ä¸­é—´ä»¶å’Œä¾èµ–)

### ä»£ç å¤æ‚åº¦é™ä½
- **ä»£ç è¡Œæ•°**: å‡å°‘ 3000+ è¡Œ
- **ä¾èµ–æ¨¡å—**: å‡å°‘ 15 ä¸ªç¬¬ä¸‰æ–¹åº“
- **é…ç½®é¡¹**: å‡å°‘ 30+ ä¸ªé…ç½®å‚æ•°

## ğŸ” å½±å“è¯„ä¼°

### æ­£é¢å½±å“
âœ… **æ¶æ„ç®€åŒ–** - æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤  
âœ… **éƒ¨ç½²ç®€åŒ–** - å‡å°‘é…ç½®å’Œä¾èµ–  
âœ… **é£é™©é™ä½** - æ¶ˆé™¤çˆ¬è™«ç›¸å…³çš„æ³•å¾‹å’ŒæŠ€æœ¯é£é™©  
âœ… **æ€§èƒ½æå‡** - èµ„æºä½¿ç”¨æ›´é«˜æ•ˆ  
âœ… **å¼€å‘æ•ˆç‡** - ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½ï¼Œå¼€å‘æ›´å¿«é€Ÿ  

### éœ€è¦é€‚åº”çš„å˜åŒ–
âš ï¸ **æ•°æ®è·å–æ–¹å¼** - ä»è‡ªåŠ¨çˆ¬å–æ”¹ä¸ºæ‰‹åŠ¨å¯¼å…¥  
âš ï¸ **æ‰¹é‡å¤„ç†** - éœ€è¦å‡†å¤‡æ ‡å‡†æ ¼å¼çš„æ•°æ®æ–‡ä»¶  
âš ï¸ **å·¥ä½œæµç¨‹** - å†…å®¹è·å–æµç¨‹éœ€è¦é‡æ–°è®¾è®¡  

## ğŸ“š ç›¸å…³æ–‡æ¡£æ›´æ–°

### éœ€è¦æ›´æ–°çš„æ–‡æ¡£
- [ ] `README.md` - é¡¹ç›®ä»‹ç»å’Œå¿«é€Ÿå¼€å§‹
- [ ] `CLAUDE.md` - Claudeå¼€å‘æŒ‡å—  
- [ ] `docs/architecture/02-microservices-architecture.md` - å¾®æœåŠ¡æ¶æ„
- [ ] `docs/api/` - APIæ–‡æ¡£
- [ ] `docker-compose.*.yml` - éƒ¨ç½²é…ç½®

### æ–°å¢æ–‡æ¡£
- [x] `ARCHITECTURE_UPDATE.md` - æœ¬æ›´æ–°æ–‡æ¡£
- [ ] `docs/content-management.md` - å†…å®¹ç®¡ç†è¯¦ç»†æŒ‡å—
- [ ] `docs/batch-import-guide.md` - æ‰¹é‡å¯¼å…¥æ“ä½œæŒ‡å—

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸç›®æ ‡ (1-2å‘¨)
1. **æ–‡æ¡£åŒæ­¥** - æ›´æ–°æ‰€æœ‰ç›¸å…³æ–‡æ¡£  
2. **APIæµ‹è¯•** - éªŒè¯æ‰€æœ‰å†…å®¹ç®¡ç†æ¥å£
3. **æ‰¹é‡å¯¼å…¥æµ‹è¯•** - æµ‹è¯•å„ç§æ–‡ä»¶æ ¼å¼å¯¼å…¥
4. **æ€§èƒ½åŸºå‡†æµ‹è¯•** - å»ºç«‹æ–°æ¶æ„çš„æ€§èƒ½åŸºçº¿

### ä¸­æœŸç›®æ ‡ (1ä¸ªæœˆ)
1. **å‰ç«¯é€‚é…** - æ›´æ–°å‰ç«¯ç•Œé¢ï¼Œç§»é™¤çˆ¬è™«ç›¸å…³åŠŸèƒ½
2. **æ•°æ®è¿ç§»å·¥å…·** - å¼€å‘æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·
3. **ç”¨æˆ·æŒ‡å—** - ç¼–å†™è¯¦ç»†çš„ç”¨æˆ·æ“ä½œæŒ‡å—
4. **åŸ¹è®­ææ–™** - å‡†å¤‡å›¢é˜ŸåŸ¹è®­èµ„æ–™

### é•¿æœŸç›®æ ‡ (3ä¸ªæœˆ)
1. **æ™ºèƒ½æ¨è** - åŸºäºå†…å®¹ç‰¹å¾çš„æ™ºèƒ½æ¨èç³»ç»Ÿ
2. **å†…å®¹åˆ†æ** - é«˜çº§æ–‡æœ¬åˆ†æå’Œæƒ…æ„Ÿè¯†åˆ«
3. **APIæ‰©å±•** - ç¬¬ä¸‰æ–¹æ•°æ®æºé›†æˆæ¥å£
4. **è‡ªåŠ¨åŒ–å·¥å…·** - å†…å®¹å¤„ç†è‡ªåŠ¨åŒ–æµç¨‹

---

## ğŸ“ è”ç³»æ”¯æŒ

å¦‚æœåœ¨æ¶æ„æ›´æ–°è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»ï¼š

**æŠ€æœ¯è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ  
**æ–‡æ¡£ç»´æŠ¤**: æ¶æ„å›¢é˜Ÿ  
**é—®é¢˜åé¦ˆ**: è¯·æäº¤Issueåˆ°é¡¹ç›®ä»“åº“

---

*æ–‡æ¡£ç‰ˆæœ¬: v2.0*  
*æœ€åæ›´æ–°: 2025-09-04*  
*æ›´æ–°ç±»å‹: æ¶æ„é‡æ„*