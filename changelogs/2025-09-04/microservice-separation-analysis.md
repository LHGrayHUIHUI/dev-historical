# å¾®æœåŠ¡ä¸šåŠ¡åŠŸèƒ½åˆ†ç¦»åˆ†ææŠ¥å‘Š

**æ—¥æœŸ**: 2025-09-04  
**ç±»å‹**: æ¶æ„åˆ†æä¸ä¿®æ­£  
**å½±å“çº§åˆ«**: é‡å¤§æ¶æ„è°ƒæ•´  

## ğŸ” é—®é¢˜è¯†åˆ«

### å½“å‰æ¶æ„é—®é¢˜
é€šè¿‡æ·±å…¥åˆ†æå‘ç°ï¼Œä¸¤ä¸ªå¾®æœåŠ¡å­˜åœ¨ä¸¥é‡çš„ä¸šåŠ¡åŠŸèƒ½é‡å¤å’Œè¾¹ç•Œæ¨¡ç³Šï¼š

#### âŒ å‘ç°çš„é‡å¤åŠŸèƒ½
```
data-source æœåŠ¡ï¼ˆé”™è¯¯é‡å¤ï¼‰:
â”œâ”€â”€ src/storage/minio_client.py     # é‡å¤MinIOå®ç°
â”œâ”€â”€ src/api/media.py               # é‡å¤åª’ä½“ä¸Šä¼ API
â””â”€â”€ main.py                        # é‡å¤å­˜å‚¨åˆå§‹åŒ–

data-collection æœåŠ¡ï¼ˆæ­£ç¡®å®ç°ï¼‰:
â”œâ”€â”€ src/utils/storage.py           # å®Œæ•´MinIOå®ç° âœ…
â”œâ”€â”€ src/processors/               # å®Œæ•´æ–‡ä»¶å¤„ç†å™¨ âœ…
â”œâ”€â”€ src/controllers/              # æ–‡ä»¶ä¸Šä¼ API âœ…
â””â”€â”€ src/workers/                  # å¼‚æ­¥å¤„ç†å·¥ä½œå™¨ âœ…
```

#### ğŸš¨ æ¶æ„æ··ä¹±åŸå› 
1. **åŠŸèƒ½è¾¹ç•Œä¸æ¸…æ™°**: data-sourceé”™è¯¯åœ°æ·»åŠ äº†å­˜å‚¨å’Œæ–‡ä»¶å¤„ç†åŠŸèƒ½
2. **é‡å¤å¼€å‘**: ä¸¤ä¸ªæœåŠ¡éƒ½å®ç°äº†MinIOå®¢æˆ·ç«¯
3. **èŒè´£æ··æ·†**: data-sourceæœ¬åº”ä¸“æ³¨æ•°æ®ç®¡ç†ï¼Œå´æ‰¿æ‹…äº†æ–‡ä»¶å­˜å‚¨èŒè´£

## ğŸ¯ æ­£ç¡®çš„ä¸šåŠ¡åˆ†ç¦»æ–¹æ¡ˆ

### æ˜ç¡®çš„æœåŠ¡èŒè´£å®šä¹‰

#### ğŸ“Š data-sourceæœåŠ¡ï¼ˆæ•°æ®ç®¡ç†æœåŠ¡ï¼‰
**æ ¸å¿ƒèŒè´£**: çº¯æ•°æ®ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘
```yaml
ä¸»è¦åŠŸèƒ½:
  - âœ… å†…å®¹æ•°æ®çš„CRUDæ“ä½œï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰
  - âœ… å†…å®¹æœç´¢å’Œè¿‡æ»¤
  - âœ… å†…å®¹åˆ†ç±»å’Œæ ‡ç­¾ç®¡ç†  
  - âœ… æ•°æ®ç»Ÿè®¡å’Œåˆ†æ
  - âœ… ä¸šåŠ¡è§„åˆ™å’ŒéªŒè¯é€»è¾‘
  - âœ… å†…å®¹çŠ¶æ€ç®¡ç†ï¼ˆå‘å¸ƒã€è‰ç¨¿ã€å½’æ¡£ç­‰ï¼‰

æ•°æ®å­˜å‚¨:
  - âœ… MongoDB: å†…å®¹æ•°æ®ã€å…ƒæ•°æ®
  - âœ… Redis: ç¼“å­˜ã€ä¼šè¯ã€ç»Ÿè®¡æ•°æ®

APIç«¯ç‚¹ç¤ºä¾‹:
  - POST /api/v1/content/              # åˆ›å»ºå†…å®¹ï¼ˆæ¥æ”¶URLå¼•ç”¨ï¼‰
  - GET  /api/v1/content/              # æŸ¥è¯¢å†…å®¹åˆ—è¡¨
  - PUT  /api/v1/content/{id}          # æ›´æ–°å†…å®¹
  - DELETE /api/v1/content/{id}        # åˆ é™¤å†…å®¹
  - GET  /api/v1/content/search        # å†…å®¹æœç´¢
  - GET  /api/v1/content/stats         # å†…å®¹ç»Ÿè®¡
```

#### ğŸ“ data-collectionæœåŠ¡ï¼ˆæ–‡ä»¶å¤„ç†æœåŠ¡ï¼‰  
**æ ¸å¿ƒèŒè´£**: æ–‡ä»¶å­˜å‚¨ã€å¤„ç†å’Œåª’ä½“ç®¡ç†
```yaml
ä¸»è¦åŠŸèƒ½:
  - âœ… æ–‡ä»¶ä¸Šä¼ å’Œå­˜å‚¨ï¼ˆMinIOå¯¹è±¡å­˜å‚¨ï¼‰
  - âœ… å¤šæ ¼å¼æ–‡ä»¶å¤„ç†ï¼ˆPDFã€Wordã€å›¾ç‰‡OCRã€HTMLç­‰ï¼‰
  - âœ… æ–‡ä»¶å…ƒæ•°æ®ç®¡ç†
  - âœ… æ–‡ä»¶å®‰å…¨æ£€æµ‹ï¼ˆç—…æ¯’æ‰«æï¼‰
  - âœ… å¼‚æ­¥æ–‡ä»¶å¤„ç†å·¥ä½œæµ
  - âœ… é¢„ç­¾åURLç”Ÿæˆå’Œç®¡ç†

æ•°æ®å­˜å‚¨:
  - âœ… PostgreSQL: æ–‡ä»¶å…ƒæ•°æ®ã€å¤„ç†è®°å½•
  - âœ… MinIO: å¯¹è±¡æ–‡ä»¶å­˜å‚¨
  - âœ… RabbitMQ: å¼‚æ­¥å¤„ç†é˜Ÿåˆ—

APIç«¯ç‚¹ç¤ºä¾‹:
  - POST /api/v1/files/upload          # æ–‡ä»¶ä¸Šä¼ 
  - GET  /api/v1/files/{file_id}       # è·å–æ–‡ä»¶ä¿¡æ¯
  - DELETE /api/v1/files/{file_id}     # åˆ é™¤æ–‡ä»¶
  - POST /api/v1/files/batch-upload    # æ‰¹é‡æ–‡ä»¶ä¸Šä¼ 
  - GET  /api/v1/files/presigned-url   # è·å–é¢„ç­¾åURL
```

## ğŸ”§ æœåŠ¡é—´åä½œæ¨¡å¼

### æ¨èå·¥ä½œæµ
```mermaid
graph TD
    A[Vue3å‰ç«¯] --> B[data-collectionæœåŠ¡]
    B --> C[è¿”å›æ–‡ä»¶URL]
    A --> D[data-sourceæœåŠ¡]
    D --> E[å­˜å‚¨URLå¼•ç”¨]
    
    subgraph "æ•°æ®æµå‘"
        F[1. ä¸Šä¼ æ–‡ä»¶] --> G[2. è·å–æ–‡ä»¶URL]
        G --> H[3. åˆ›å»ºå†…å®¹è®°å½•]
        H --> I[4. å…³è”æ–‡ä»¶URL]
    end
```

### Vue3å‰ç«¯é›†æˆç¤ºä¾‹
```javascript
// æ ‡å‡†å·¥ä½œæµï¼šå…ˆä¸Šä¼ æ–‡ä»¶ï¼Œå†åˆ›å»ºå†…å®¹
async function createContentWithMedia(contentData, files) {
    // 1. ä¸Šä¼ æ–‡ä»¶åˆ°data-collectionæœåŠ¡
    const fileResponse = await fetch('/api/collection/files/upload', {
        method: 'POST',
        body: createFileFormData(files)
    });
    const { file_urls } = await fileResponse.json();
    
    // 2. åˆ›å»ºå†…å®¹è®°å½•åˆ°data-sourceæœåŠ¡ï¼Œå…³è”æ–‡ä»¶URL
    const contentResponse = await fetch('/api/v1/content/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            ...contentData,
            images: file_urls.filter(url => url.includes('/images/')),
            videos: file_urls.filter(url => url.includes('/videos/')),
        })
    });
    
    return contentResponse.json();
}
```

## ğŸ§¹ å¿…è¦çš„ä»£ç æ¸…ç†å·¥ä½œ

### éœ€è¦ä»data-sourceæœåŠ¡åˆ é™¤çš„æ–‡ä»¶
```bash
# é‡å¤çš„å­˜å‚¨åŠŸèƒ½
rm -rf services/data-source/src/storage/
rm -f services/data-source/src/api/media.py

# æ›´æ–°ä¸»åº”ç”¨
# åˆ é™¤MinIOå¯¼å…¥å’Œåˆå§‹åŒ–ä»£ç 
# åˆ é™¤åª’ä½“è·¯ç”±æ³¨å†Œ
```

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶
```yaml
services/data-source/src/main.py:
  åˆ é™¤: 
    - from .storage import init_minio_client
    - from .api.media import router as media_router
    - await init_minio_client()
    - app.include_router(media_router, ...)
    
services/data-source/src/models/content.py:
  ä¿ç•™:
    - images: List[HttpUrl] = Field(default_factory=list)  # å­˜å‚¨URLå¼•ç”¨
    - videos: List[HttpUrl] = Field(default_factory=list)  # å­˜å‚¨URLå¼•ç”¨
```

### data-collectionæœåŠ¡ä¿æŒä¸å˜
data-collectionæœåŠ¡çš„å­˜å‚¨åŠŸèƒ½å®ç°æ­£ç¡®ï¼Œä¿æŒç°çŠ¶ï¼š
- `src/utils/storage.py` - å®Œæ•´çš„MinIOå®¢æˆ·ç«¯å®ç°
- `src/controllers/` - æ–‡ä»¶ä¸Šä¼ APIæ§åˆ¶å™¨
- `src/processors/` - æ–‡ä»¶å¤„ç†å™¨
- `src/workers/` - å¼‚æ­¥å¤„ç†å·¥ä½œå™¨

## ğŸ“‹ ä¿®æ­£åçš„APIè®¾è®¡

### data-sourceæœåŠ¡APIï¼ˆçº¯æ•°æ®ç®¡ç†ï¼‰
```yaml
å†…å®¹ç®¡ç†:
  POST   /api/v1/content/              # åˆ›å»ºå†…å®¹ï¼ˆåŒ…å«æ–‡ä»¶URLå¼•ç”¨ï¼‰
  GET    /api/v1/content/              # æŸ¥è¯¢å†…å®¹åˆ—è¡¨  
  GET    /api/v1/content/{id}          # è·å–å•ä¸ªå†…å®¹
  PUT    /api/v1/content/{id}          # æ›´æ–°å†…å®¹
  DELETE /api/v1/content/{id}          # åˆ é™¤å†…å®¹

å†…å®¹æœç´¢:
  GET    /api/v1/content/search        # å†…å®¹æœç´¢
  GET    /api/v1/content/tags          # è·å–æ ‡ç­¾åˆ—è¡¨
  GET    /api/v1/content/categories    # è·å–åˆ†ç±»åˆ—è¡¨

æ•°æ®ç»Ÿè®¡:
  GET    /api/v1/content/stats         # å†…å®¹ç»Ÿè®¡ä¿¡æ¯
  GET    /api/v1/content/analytics     # å†…å®¹åˆ†ææ•°æ®
```

### data-collectionæœåŠ¡APIï¼ˆæ–‡ä»¶å¤„ç†ï¼‰
```yaml
æ–‡ä»¶ç®¡ç†:
  POST   /api/v1/files/upload          # å•æ–‡ä»¶ä¸Šä¼ 
  POST   /api/v1/files/batch-upload    # æ‰¹é‡æ–‡ä»¶ä¸Šä¼ 
  GET    /api/v1/files/{file_id}       # è·å–æ–‡ä»¶ä¿¡æ¯
  DELETE /api/v1/files/{file_id}       # åˆ é™¤æ–‡ä»¶

æ–‡ä»¶å¤„ç†:
  POST   /api/v1/files/extract-text    # æ–‡æœ¬æå–
  GET    /api/v1/files/{file_id}/metadata  # è·å–æ–‡ä»¶å…ƒæ•°æ®
  POST   /api/v1/files/validate        # æ–‡ä»¶éªŒè¯

å­˜å‚¨ç®¡ç†:
  GET    /api/v1/files/presigned-url   # ç”Ÿæˆé¢„ç­¾åURL  
  POST   /api/v1/files/cleanup         # æ¸…ç†æœªä½¿ç”¨æ–‡ä»¶
```

## ğŸ“Š æ¶æ„åˆ†ç¦»ä¼˜åŠ¿

### âœ… æ¸…æ™°çš„èŒè´£åˆ†ç¦»
1. **data-source**: ä¸“æ³¨ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®ç®¡ç†
2. **data-collection**: ä¸“æ³¨æ–‡ä»¶å¤„ç†å’Œå­˜å‚¨ç®¡ç†
3. **é¿å…åŠŸèƒ½é‡å¤**: æ¯ä¸ªæœåŠ¡éƒ½æœ‰æ˜ç¡®çš„è¾¹ç•Œ

### âœ… æ›´å¥½çš„å¯ç»´æŠ¤æ€§
1. **å•ä¸€èŒè´£**: æ¯ä¸ªæœåŠ¡ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½
2. **ç‹¬ç«‹éƒ¨ç½²**: å¯ä»¥ç‹¬ç«‹æ‰©å±•å’Œå‡çº§
3. **æ•…éšœéš”ç¦»**: æ–‡ä»¶å­˜å‚¨é—®é¢˜ä¸å½±å“æ•°æ®ç®¡ç†

### âœ… æ€§èƒ½ä¼˜åŒ–
1. **èµ„æºä¼˜åŒ–**: data-sourceä¸éœ€è¦æ–‡ä»¶å¤„ç†èµ„æº
2. **ç¼“å­˜ç­–ç•¥**: å„æœåŠ¡å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–ç¼“å­˜
3. **è´Ÿè½½åˆ†ç¦»**: æ–‡ä»¶å¤„ç†è´Ÿè½½ä¸æ•°æ®æŸ¥è¯¢è´Ÿè½½åˆ†ç¦»

## ğŸ¯ å®æ–½è®¡åˆ’

### é˜¶æ®µ1: ä»£ç æ¸…ç†ï¼ˆç«‹å³æ‰§è¡Œï¼‰
- [ ] åˆ é™¤data-sourceä¸­çš„é‡å¤å­˜å‚¨åŠŸèƒ½
- [ ] æ›´æ–°main.pyï¼Œç§»é™¤MinIOåˆå§‹åŒ–
- [ ] æ¸…ç†é‡å¤çš„APIç«¯ç‚¹

### é˜¶æ®µ2: APIæ ‡å‡†åŒ–ï¼ˆ1å¤©ï¼‰
- [ ] ç¡®ä¿data-collectionçš„æ–‡ä»¶ä¸Šä¼ APIå®Œæ•´
- [ ] ä¼˜åŒ–data-sourceçš„å†…å®¹ç®¡ç†API
- [ ] æ›´æ–°APIæ–‡æ¡£å’Œç¤ºä¾‹

### é˜¶æ®µ3: æµ‹è¯•éªŒè¯ï¼ˆ1å¤©ï¼‰
- [ ] æµ‹è¯•æœåŠ¡é—´åä½œæµç¨‹
- [ ] éªŒè¯Vue3å‰ç«¯é›†æˆå·¥ä½œæµ
- [ ] ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•

### é˜¶æ®µ4: æ–‡æ¡£æ›´æ–°ï¼ˆå³æ—¶ï¼‰
- [ ] æ›´æ–°æ¶æ„æ–‡æ¡£
- [ ] æ›´æ–°APIæ–‡æ¡£
- [ ] æ›´æ–°å¼€å‘æŒ‡å—

## ğŸ“ å…³é”®å†³ç­–è®°å½•

### å†³ç­–1: æœåŠ¡èŒè´£æ˜ç¡®åˆ†ç¦»
- **å†³ç­–**: data-sourceä¸“æ³¨æ•°æ®ç®¡ç†ï¼Œdata-collectionä¸“æ³¨æ–‡ä»¶å¤„ç†
- **åŸå› **: é¿å…åŠŸèƒ½é‡å¤ï¼Œæé«˜å¯ç»´æŠ¤æ€§
- **å½±å“**: éœ€è¦åˆ é™¤data-sourceä¸­çš„å­˜å‚¨åŠŸèƒ½

### å†³ç­–2: ä¿æŒdata-collectionç°æœ‰å®ç°
- **å†³ç­–**: data-collectionçš„æ–‡ä»¶å¤„ç†åŠŸèƒ½è®¾è®¡æ­£ç¡®ï¼Œä¿æŒä¸å˜
- **åŸå› **: å·²æœ‰å®Œæ•´çš„MinIOé›†æˆå’Œæ–‡ä»¶å¤„ç†å™¨
- **å½±å“**: ä¸“æ³¨äºæ¸…ç†data-sourceä¸­çš„é‡å¤åŠŸèƒ½

### å†³ç­–3: URLå¼•ç”¨æ¨¡å¼
- **å†³ç­–**: data-sourceå­˜å‚¨æ–‡ä»¶URLå¼•ç”¨ï¼Œä¸ç›´æ¥å¤„ç†æ–‡ä»¶
- **åŸå› **: ç¬¦åˆå¾®æœåŠ¡æ¶æ„åŸåˆ™ï¼Œæ¸…æ™°çš„æ•°æ®è¾¹ç•Œ
- **å½±å“**: å†…å®¹æ¨¡å‹ä¿ç•™imageså’Œvideoså­—æ®µä½œä¸ºURLå¼•ç”¨

---

**åˆ†æç»“è®º**: å½“å‰æ¶æ„å­˜åœ¨ä¸¥é‡çš„åŠŸèƒ½é‡å¤é—®é¢˜ï¼Œéœ€è¦ç«‹å³ä¿®æ­£ã€‚åˆ é™¤data-sourceä¸­çš„å­˜å‚¨åŠŸèƒ½ï¼Œä¿æŒdata-collectionçš„æ–‡ä»¶å¤„ç†èƒ½åŠ›ï¼Œå»ºç«‹æ¸…æ™°çš„æœåŠ¡è¾¹ç•Œã€‚

**æ‰§è¡Œä¼˜å…ˆçº§**: é«˜ä¼˜å…ˆçº§ - ç«‹å³æ‰§è¡Œä»£ç æ¸…ç†ï¼Œé¿å…æ¶æ„æ··ä¹±æŒç»­æ‰©å¤§ã€‚